# Transaction 과 ACID



### Transaction

- 쇼핑몰에서 카드 결제를 완료하고, 그 이후 어딘가에서 에러가 났다. 그때 결제가 되지 않고, 재고에도 변화가 없도록 DB에 필요한 처리

> 좀 더 엔지니어적으로 표현하자면 "읽기와 쓰기를 하나의 논리적 단위로 묶는 방법"
>
> 묶여진 단위는 commit 되거나 rollback 이라는 기능이 보장되어야 한다.



### ACID

- 트랜잭션이 제공하는 안전성 보장은 원자성(Atomicity), 일관성(Consistency), 격리성(Isolation), 지속성(Durability)를 의미하는 ACID 로 알려져 있다.

> 그러나 실제로 DB 회사마다 그 정의가 조금씩 다르며, 무엇을 보장하는지 직접 살펴봐야함
>
> 우리에게 중요한 것은 전체적인 흐름보다도 때론 매우 작은 detail 상황 때문이다.

- ACID 표준을 따르지 않는 시스템을 BASE 라고 부르며, 다음의 특징을 따른다.
  - 기본적으로 가용성을 제공하고(Basically Available)
  - 유연한 상태를 가지며(Soft state)
  - 최종적 일관성(Eventual consistency)

> ACID 보다 더 애매함



#### 원자성(Atomicity)

- client가 쓰기 몇 개의 작업을 수행하고자 할 때, 그 중 일부만 처리된 후 결함이 발생하여(process가 죽거나, network 연결이 끊어지거나, 디스크에 문제가 발생하거나 등등) commit 해서는 안되는 상황이면 abort (DB는 지금까지 쓴 작업을 무시하거나 취소해야 한다) 하는 작업을 Atomicity 라 한다.



#### 일관성(Consistency)

- 데이터 베이스가 "좋은 상태"에 있어야 한다는 것의 애플리케이션에 특화된 개념을 가르킨다.

  일관성이라는 단어가 가지는 의미는 항상 진실이어야 하고, 데이터에 관한 어떤 선언(invariant 불변식)이 있다는 것이다.

  예를 들면, 회계 시스템에서 모든 계좌에 걸친 대변과 차변은 항상 맞아떨어져야 한다. 와 같은 예시가 있다.

> 일관성은 불변식에 의존하고, 불변식 개념은 apllication 에서 관리할 책임. DB의 책임이라 하긴 어려움. 물론 DB에서 검증하는 불변식 개념도 있다. 대표적으로 FK, unique가 이에 해당한다.
>
> 그러나 application에서 데이터가 유효한지 아닌지를 정의하고 DB는 데이터를 저장할 뿐이다.



#### 격리성(Isolation)

- DB를 사용할 때 하나의 컴퓨터로만 DB에 접속하지 않는다. 여러 client가 접속하는데 이때 문제는 동일한 record(document)에 접근하면 동시성 문제(경쟁 조건)에 직면한다.

  ACID에서 격리성은 동시에 실행되는 transaction은 서로 격리된다는 것을 의미한다.

  하나의 트랜잭션이 다른 트랜잭션을 절대로 방해할 수 없다.

> 이러한 격리성을 직렬성으로 표현하기도 한다. 각 트랜잭션이 유일한 트랜잭션인 것 처럼 격리시켜버리는 것을 의미하는데, 각 트랜잭션이 순차적으로 실행됐을 때와 동일한 결과를 보여준다.
>
> snapshot 격리라는 방법도 있다.



#### 지속성(Durability)

- Data 가 손실될 염려 없이 안전한 저장소를 제공하는 것.

  지속성은 성공적으로 commit 된 데이터는 H/W 결함이 발생하거나, DB가 죽더라도 보존되어야 하며, SSD와 같은 비휘발성 저장소에 기록됐다는 뜻이다.

  또한 복제 기능이 있는 DB에서 지속성은 다른 node 몇개의 성공적으로 복사가 됐음을 의미하기도 함.



-출처-

[Camael's note](https://blog.yevgnenll.me/)
